<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CORE MASTER 2026 | Personal</title>
  <link rel="stylesheet" href="../style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root {
      --bg-fresh: #f8fafc;        /* Heller, frischer Hintergrund */
      --card-bg: #ffffff;         /* Weiß für Karten */
      --border-light: #e2e8f0;    /* Sanfte Linien */
      --text-dark: #1e293b;       /* Dunkles Blau-Grau für Text */
      --text-soft: #64748b;       /* Weicher Text für Labels */
      --brand-color: #4f46e5;     /* Frisches Indigo als Akzent */
    }

    body { background-color: var(--bg-fresh); color: var(--text-dark); }

    /* Tab-Navigation Fresh */
    .tab-container { display: flex; gap: 5px; margin-bottom: 30px; background: #eef2f6; padding: 5px; border-radius: 12px; width: fit-content; }
    .tab-btn { 
      background: transparent; border: none; color: var(--text-soft); padding: 10px 20px; 
      font-size: 13px; font-weight: 600; cursor: pointer; border-radius: 8px; 
      display: flex; align-items: center; gap: 8px; transition: 0.2s;
    }
    .tab-btn.active { background: var(--card-bg); color: var(--brand-color); shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }

    .view-section { display: none; }
    .view-section.active { display: block; animation: fadeIn 0.3s ease-in; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Formular Styling Fresh */
    .editor-container { max-width: 900px; margin: 0 auto; }
    .form-group { background: var(--card-bg); border: 1px solid var(--border-light); border-radius: 16px; padding: 30px; margin-bottom: 25px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .form-title { font-size: 14px; font-weight: 700; color: var(--text-dark); margin-bottom: 25px; display: flex; align-items: center; gap: 10px; }
    .form-title i { color: var(--brand-color); }
    
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    
    label { font-size: 11px; font-weight: 600; color: var(--text-soft); text-transform: uppercase; margin-bottom: 8px; display: block; }
    
    input, select, textarea { 
      width: 100%; padding: 12px; border: 1px solid var(--border-light); 
      border-radius: 10px; background: #fcfdfe; color: var(--text-dark); font-size: 14px; transition: 0.2s;
    }
    input:focus { border-color: var(--brand-color); outline: none; background: #fff; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }

    /* Foto Bereich */
    .photo-area { display: flex; align-items: center; gap: 25px; margin-bottom: 30px; background: white; padding: 20px; border-radius: 16px; border: 1px solid var(--border-light); }
    .avatar-circle { width: 80px; height: 80px; border-radius: 50%; background: #f1f5f9; border: 2px solid #fff; box-shadow: 0 0 15px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }

    .btn-save-fresh { 
      background: var(--brand-color); color: #fff; border: none; padding: 16px; 
      border-radius: 12px; font-weight: 700; width: 100%; cursor: pointer; 
      font-size: 15px; box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3); transition: 0.2s;
    }
    .btn-save-fresh:hover { transform: translateY(-2px); filter: brightness(1.1); }

    /* Mitarbeiter Liste */
    .staff-row { 
      background: var(--card-bg); border: 1px solid var(--border-light); padding: 15px 25px; 
      border-radius: 12px; display: flex; align-items: center; justify-content: space-between; 
      margin-bottom: 12px; transition: 0.2s; 
    }
    .staff-row:hover { border-color: var(--brand-color); transform: scale(1.01); }
  </style>
</head>
<body>

  <aside class="sidebar">
    <div class="sidebar-header">
      <div style="font-weight: 900; font-size: 20px; color: var(--brand-color);">CORE MASTER</div>
      <div style="font-size: 10px; color: var(--text-soft); font-weight: 700;">ENTERPRISE 2026</div>
    </div>
    <div class="sidebar-content">
      <a href="../admin.html" class="nav-link"><i data-lucide="layout-dashboard"></i> Dashboard</a>
      <a href="kunden.html" class="nav-link"><i data-lucide="users"></i> Kunden</a>
      <a href="mitarbeiter.html" class="nav-link active"><i data-lucide="hard-hat"></i> Mitarbeiter</a>
      </div>
  </aside>

  <main class="main">
    <header class="header">
      <div class="tab-container">
        <button class="tab-btn active" onclick="switchTab('list', this)"><i data-lucide="users"></i> Mitarbeiterliste</button>
        <button class="tab-btn" onclick="switchTab('add', this)"><i data-lucide="plus-circle"></i> Neues Profil</button>
      </div>
    </header>

    <div class="content">
      
      <section id="view-list" class="view-section active">
        <div id="staff-list">
            </div>
      </section>

      <section id="view-add" class="view-section">
        <div class="editor-container">
          
          <div class="photo-area">
            <div class="avatar-circle" id="preview-box"><i data-lucide="camera" color="#94a3b8"></i></div>
            <div>
                <h4 style="margin:0; font-size:16px;">Profilbild hochladen</h4>
                <p style="font-size:12px; color:var(--text-soft); margin:5px 0 15px 0;">Empfohlen: Quadratisch, min. 400x400px</p>
                <input type="file" id="m_photo" style="display:none" onchange="previewImage(this)">
                <button onclick="document.getElementById('m_photo').click()" style="background:#fff; border:1px solid var(--border-light); color:var(--text-dark); padding:8px 16px; border-radius:8px; cursor:pointer; font-size:12px; font-weight:600; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">Datei wählen</button>
            </div>
          </div>

          <div class="form-group">
            <div class="form-title"><i data-lucide="user"></i> Stammdaten</div>
            <div class="grid-3">
                <div><label>Vorname</label><input type="text" id="m_first_name" placeholder="z.B. Max"></div>
                <div><label>Nachname</label><input type="text" id="m_last_name" placeholder="Mustermann"></div>
                <div><label>E-Mail</label><input type="email" id="m_email" placeholder="max@beispiel.de"></div>
            </div>
            <div class="grid-3" style="margin-top:20px;">
                <div><label>Telefon</label><input type="text" id="m_phone"></div>
                <div><label>Notfall-Kontakt</label><input type="text" id="m_emergency"></div>
                <div><label>Position</label>
                  <select id="m_pos">
                    <option>Objektleiter</option>
                    <option>Sicherheitskraft</option>
                    <option>Verwaltung</option>
                  </select>
                </div>
            </div>
          </div>

          <div class="form-group">
            <div class="form-title"><i data-lucide="map-pin"></i> Adresse & Soziales</div>
            <div class="grid-2">
                <div><label>Straße & Hausnummer</label><input type="text" id="m_address"></div>
                <div class="grid-2">
                  <div><label>PLZ</label><input type="text" id="m_zip"></div>
                  <div><label>Stadt</label><input type="text" id="m_city"></div>
                </div>
            </div>
          </div>

          <div class="form-group">
            <div class="form-title"><i data-lucide="credit-card"></i> Abrechnungsdetails</div>
            <div class="grid-3">
                <div><label>Steuer-ID</label><input type="text" id="m_tax_id"></div>
                <div><label>SV-Nummer</label><input type="text" id="m_insurance_number"></div>
                <div><label>Krankenkasse</label><input type="text" id="m_health"></div>
            </div>
          </div>

          <button class="btn-save-fresh" onclick="saveStaff()">MITARBEITER REGISTRIEREN</button>

        </div>
      </section>

    </div>
  </main>

  <script src="../config.js"></script>
  <script>
    lucide.createIcons();
    const WS_ID = '8648e581-297d-419b-9c71-292418e26895';

    function switchTab(viewId, btn) {
      document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('view-' + viewId).classList.add('active');
      btn.classList.add('active');
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => document.getElementById('preview-box').innerHTML = `<img src="${e.target.result}">`;
            reader.readAsDataURL(input.files[0]);
        }
    }

    async function loadStaff() {
      const { data } = await _supabase.from('employees').select('*').order('created_at', {ascending: false});
      const list = document.getElementById('staff-list');
      list.innerHTML = data.map(m => `
        <div class="staff-row">
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="width:45px; height:45px; background:var(--bg-fresh); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--brand-color); font-weight:800; border:1px solid var(--border-light);">${m.first_name[0]}</div>
                <div>
                    <div style="font-weight:700; font-size:15px; color:var(--text-dark);">${m.first_name} ${m.last_name}</div>
                    <div style="font-size:12px; color:var(--text-soft);">${m.email}</div>
                </div>
            </div>
            <div style="display:flex; gap:20px; align-items:center;">
                <span style="font-size:11px; background:#f1f5f9; padding:4px 10px; border-radius:20px; color:var(--text-soft); font-weight:600;">${m.role || 'Mitarbeiter'}</span>
                <button onclick="deleteStaff('${m.id}')" style="background:none; border:none; color:#cbd5e1; cursor:pointer; transition:0.2s;" onmouseover="this.style.color='#f87171'"><i data-lucide="trash-2" size="18"></i></button>
            </div>
        </div>
      `).join('');
      lucide.createIcons();
    }

    async function saveStaff() {
      const payload = {
        workspace_id: WS_ID,
        first_name: document.getElementById('m_first_name').value,
        last_name: document.getElementById('m_last_name').value,
        email: document.getElementById('m_email').value,
        phone: document.getElementById('m_phone').value,
        address: document.getElementById('m_address').value,
        tax_id: document.getElementById('m_tax_id').value,
        insurance_number: document.getElementById('m_insurance_number').value,
        health_insurance: document.getElementById('m_health').value
      };
      const { error } = await _supabase.from('employees').insert([payload]);
      if(!error) location.reload();
    }

    document.addEventListener('DOMContentLoaded', loadStaff);
  </script>
</body>
</html>
